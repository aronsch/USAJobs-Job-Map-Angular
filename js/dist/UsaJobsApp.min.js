/*! 
* UsaJobsApp - v0.0.1 - 2016-01-08
* https://github.com/aronsch/USAJobs-Job-Map-Angular
* Copyright (c) 2016 Aron Schneider
* Licensed MIT
*/
!function(){function a(a,b,c,d){function e(b,d){angular.forEach(a.jobs.JobData,function(a){a.setVisibleWithPredicate(d)}),c.jobs.updateVisible()}function f(){angular.forEach(a.jobs.JobData,function(a){a.visible=!0}),c.jobs.updateVisible()}a.jobs=b,a.jobs.orgCode=a.orgCode,a.jobs.orgName=a.orgName,a.orgSearchUrl=d.usaJobs.searchBaseUrl+a.orgId,a.jobs.orgSearchUrl=a.orgSearchUrl,a.jobs.getJobs(),c.filters.onChanged(e),c.filters.onCleared(f)}function b(){return{restrict:"A",scope:{orgCode:"@",orgName:"@"},controller:"UsaJobsAppController"}}function c(a){function b(b,c){a.$broadcast(b,c)}function c(b,c){a.$on(b,c)}var d=this.names={},e=this.jobs={},f=this.geodata={},g=this.location={},h=this.filters={};d.jobs={available:"usajobs.events.jobs-available",updateVisible:"usajobs.events.job-visibility-updated-needed",queryStarted:"usajobs.events.job-query-started"},d.geodata={available:"usajobs.events.geodata-available",notAvailable:"usajobs.events.geodata-not-available"},d.location={setAttribution:"usajobs.events.location.set-geocoding-attribution"},d.filters={changed:"usajobs.events.filter-values-changed",cleared:"usajobs.events.filter-values-cleared",clear:"usajobs.events.filter-clear-filters"},d.focus={job:"usajobs.events.focus-set-job",location:"usajobs.events.focus-set-location"},e.available=function(){b(d.jobs.available)},e.onAvailable=function(a){c(d.jobs.available,a)},e.updateVisible=function(){b(d.jobs.updateVisible)},e.onUpdateVisible=function(a){c(d.jobs.updateVisible,a)},e.queryStarted=function(){b(d.jobs.queryStarted)},e.onQueryStarted=function(a){c(d.jobs.queryStarted,a)},f.available=function(a){b(d.geodata.available,a)},f.notAvailable=function(a){b(d.geodata.notAvailable,a)},f.onAvailable=function(a){c(d.geodata.available,a)},f.onNotAvailable=function(a){c(d.geodata.notAvailable,a)},g.setAttribution=function(a){b(d.location.setAttribution,a)},g.onSetAttribution=function(a){c(d.location.setAttribution,a)},h.changed=function(a){b(d.filters.changed,a)},h.onChanged=function(a){c(d.filters.changed,a)},h.cleared=function(a){b(d.filters.cleared)},h.onCleared=function(a){c(d.filters.cleared,a)},h.clear=function(a){b(d.filters.clear)},h.onClear=function(a){c(d.filters.clear,a)}}angular.module("UsaJobsApp",["UsaJobsApp.Data","UsaJobsApp.Filters","UsaJobsApp.Map","UsaJobsApp.JobTable","UsaJobsApp.Location","UsaJobsApp.Utilities","MomentModule","LeafletModule","ui-rangeSlider"]),angular.module("UsaJobsApp").controller("UsaJobsAppController",a),angular.module("UsaJobsApp").directive("orgCode",b),angular.module("UsaJobsApp").service("eventService",c),a.$inject=["$scope","Jobs","eventService","settings"],c.$inject=["$rootScope"]}(),function(){function a(){return{usaJobs:{baseUrl:"https://data.usajobs.gov/api/jobs",orgAttr:"&OrganizationID=",pageAttr:"&Page=",searchBaseUrl:"https://www.usajobs.gov/JobSearch/Search/GetResults?OrganizationID=",dateFormat:"M/D/YYYY"},map:{center:[40.8282,-98.5795],zoom:4,attributionControl:!0,zoomControl:!0,scrollWheelZoom:!0,maxZoom:11,minZoom:1,markerClustering:!0,jobCountOverlay:!0},assets:{jobLocation:{iconUrl:"http://cdn.leafletjs.com/leaflet-0.7.3/images/marker-icon.png",iconRetinaUrl:"http://cdn.leafletjs.com/leaflet-0.7.3/images/marker-icon-2x.png",shadowUrl:"http://cdn.leafletjs.com/leaflet-0.7.3/images/marker-shadow.png",miniIconUrl:"http://cdn.leafletjs.com/leaflet-0.7.3/images/marker-icon.png",iconSize:[25,41],iconAnchor:[13,41],popupAnchor:[1,-34],shadowSize:[41,41],className:"usajobs-job-location-icon",riseOnHover:!0}},geocoding:{name:"Google",infoURL:"https://developers.google.com/maps/documentation/geocoding/",rateLimit:200,query:function(a){var b;return b="https://maps.googleapis.com/maps/api/geocode/json?address=",b+=a,encodeURI(b)},normalizeResponse:function(a){return a.results[0]?(a=a.results[0].geometry.location,{lat:a.lat,lon:a.lng,source:this.name,date:new Date}):void 0}}}}angular.module("UsaJobsApp.Settings",[]),angular.module("UsaJobsApp.Settings").value("settings",a())}(),function(){function a(a){function b(){return'<p><span ng-hide="jobs.resolved"><i class="fa fa-spinner fa-pulse"></i> Getting <strong>{{jobs.orgName}}</strong> job openings from </span><span ng-show="jobs.resolved"><strong>{{ jobs.JobData.length }} {{ jobs.orgName }}</strong> job openings are currently listed on </span><a ng-href="{{jobs.orgSearchUrl}}" target="_blank">USAJobs.gov<i class="fa fa-fw fa-external-link"></i></a> <span class="pull-right btn btn-xs btn-default usa-jobs-refresh-btn" ng-click="refresh()" ng-disabled="!jobs.resolved"><i class="fa fa-refresh" ng-class="{ \'fa-spin\': !jobs.resolved }"></i> Refresh</span></p>'}function c(){return'<div class="row form job-filter"><vacancy-count-desc></vacancy-count-desc><div class="form-group col-xs-12 col-sm-9 col-md-10 col-lg-10"><label for="salary-slider">Filter Salary</label><button type="button" class="btn btn-xs btn-danger usajobs-btn-leftmargin usajobs-btn-clear" ng-show="filters.salaryFilter.isActive()" ng-click="filters.salaryFilter.reset(true)"><i class="fa fa-close"></i> <span class="hidden-xs">Clear</span></button><div range-slider show-values="true" filter="currency" id="salary-slider" min="filters.salaryFilter.lowest" max="filters.salaryFilter.highest" step="10000" model-min="filters.salaryFilter.min" model-max="filters.salaryFilter.max" ng-class="{ disabled : !jobs.resolved }"></div></div><div class="form-group col-xs-12 col-sm-3 col-md-2 col-lg-2 text-right"><label class="hidden-xs hidden-sm">&nbsp</label><button class="btn btn-default btn-xs usajobs-filters-advanced-btn " ng-disabled="!jobs.resolved"  ng-click="toggleAdvancedFilters()">{{ showAdvancedFilters ? "Hide" : "More"}} Filters</button></div><div ng-show="showAdvancedFilters"><div class="form-group col-xs-12 col-sm-12 col-md-6 col-lg-3 usajobs-grade-filter" ng-hide="filters.gradeFilter.isDisabled"><label for="grade-slider">Filter Grade</label><button type="button" class="btn btn-xs btn-danger usajobs-btn-leftmargin usajobs-btn-clear" ng-show="filters.gradeFilter.isActive()" ng-click="filters.gradeFilter.reset(true)"><i class="fa fa-close"></i> <span class="hidden-xs">Clear</span></button><div range-slider show-values="true" filter="grade" id="grade-slider" min="filters.gradeFilter.lowest" max="filters.gradeFilter.highest" model-min="filters.gradeFilter.min" model-max="filters.gradeFilter.max" ng-class="{ disabled : !jobs.resolved }"></div></div><div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-3"><label for="filters.stringFilter.value" class="">Filter by Typing</label><button type="button" class="btn btn-xs btn-danger usajobs-btn-leftmargin usajobs-btn-clear" ng-show="filters.stringFilter.isActive()" ng-click="filters.stringFilter.reset(true)"><i class="fa fa-close"></i> <span class="hidden-xs">Clear</span></button><input ng-disabled="!jobs.resolved" type="text" class="form-control" ng-model="filters.stringFilter.value" ng-change="filter()" placeholder="filter vacancies by typing here"></div><div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-3"><label for="state-filter">State/Country&nbsp;</label><button type="button" class="btn btn-xs btn-danger usajobs-btn-leftmargin usajobs-btn-clear" ng-show="filters.state.isActive()" ng-click="filters.state.reset(true)"><i class="fa fa-close"></i> <span class="hidden-xs">Clear</span></button><select class="form-control" id="state-filter" ng-model="filters.state.value" ng-change="filter()"  ng-options="state.name for state in jobs.JobData.states"><option value=""></option></select></div><div class="form-group col-xs-12 col-sm-6 col-md-6 col-lg-3"><label for="pay-plan-filter">Filter by Pay Basis</label><button type="button" class="btn btn-xs btn-danger usajobs-btn-leftmargin usajobs-btn-clear" ng-show="filters.payFilter.isActive()" ng-click="filters.payFilter.reset(true)"><i class="fa fa-close"></i> <span class="hidden-xs">Clear</span></button><div id="pay-plan-filter" class="input-group"><label class="radio-inline"><input id="allpb-radio" name="pay-radio" type="radio" ng-change="filter()" ng-model="filters.payFilter.selection" ng-value="filters.payFilter.all" ng-disabled="!jobs.resolved"> Any&nbsp</label><label class="radio-inline"><input id="salaried-radio" name="pay-radio" type="radio" ng-change="filter()" ng-model="filters.payFilter.selection" ng-value="filters.payFilter.salaried" ng-disabled="!jobs.resolved"> Salaried&nbsp</label><label class="radio-inline"><input id="hourly-radio" name="pay-radio" type="radio" ng-change="filter()" ng-model="filters.payFilter.selection" ng-value="filters.payFilter.hourly" ng-disabled="!jobs.resolved"> Hourly&nbsp</label></div></div></div></div>'}function d(){function a(a,b){return'<i class="fa fa-fw" ng-class="{\''+b.down+"': (reverse && predicate==='"+a+"'), '"+b.up+"': (!reverse && predicate==='"+a+"')}\"></i>"}function b(a){return'<i class="fa fa-fw" ng-class="{\''+amntIcons.down+"': predicate==='salaryMaxInt', '"+amntIcons.up+"': predicate==='salaryMinInt'}\"></i>"}function c(a){return" ng-class=\"{ 'usajobs-active': predicate==='"+a+"' }\" "}function d(){return" ng-class=\"{ 'usajobs-active': predicate==='salaryMaxInt'||predicate==='salaryMinInt' }\" "}var e="",f={up:"fa-sort-asc",down:"fa-sort-desc"};return alphaIcons={up:"fa-sort-alpha-asc",down:"fa-sort-alpha-desc"},amntIcons={up:"fa-sort-amount-asc",down:"fa-sort-amount-desc"},e+='<div class="usajobs-jobs-table">',e+='<div class="clearfix usajobs-table-column-titles">',e+='<dl class="col-xs-6 col-sm-1 col-md-1 col-lg-1 small"><dt><a class="usajobs-sortbutton"'+c("JobTitle")+' title="Sort by Job Title" href="" ng-class="" ng-click="setPredicate(\'JobTitle\')">Title'+a("JobTitle",alphaIcons)+"</a></dt></dl>",e+='<dl class="hidden-xs col-sm-2 col-md-1 col-lg-1 small"><dt><a class="usajobs-sortbutton"'+c("Location")+' title="Sort by Location" href="" ng-click="setPredicate(\'Locations\')">Location'+a("Locations",alphaIcons)+"</a></dt></dl>",e+='<dl class="col-xs-6 col-sm-3 col-md-2 col-lg-2 small"><dt><a class="usajobs-sortbutton"'+d()+' title="Sort by Salary" href="" ng-click="setSalaryPredicate()">Salary'+b("salaryPredicate")+"</a></dt></dl>",e+='<dl class="col-xs-6 col-sm-2 col-md-2 col-lg-2 small"><dt><a class="usajobs-sortbutton"'+c("Grade")+' title="Sort by Pay Grade" href="" ng-click="setPredicate(\'Grade\')">Grade'+a("Grade",amntIcons)+"</a></dt></dl>",e+='<dl class="col-xs-6 col-sm-2 col-md-2 col-lg-2 small"><dt><a class="usajobs-sortbutton"'+c("daysRemaining")+' title="Sort by Announcement Closing Date" href="" ng-click="setPredicate(\'daysRemaining\')">Closes'+a("daysRemaining",f)+"</a></dt></dl>",e+='<dl class="col-xs-6 col-sm-2 col-md-2 col-lg-2 small"><dt><a class="usajobs-sortbutton"'+c("daysOpen")+' title="Sort by Announcement Opening Date" href="" ng-click="setPredicate(\'daysOpen\')">Opened'+a("daysOpen",f)+"</a></dt></dl>",e+='<dl class="hidden-xs hidden-sm hidden-md col-lg-2 small"><dt><a class="usajobs-sortbutton"'+c("AnnouncementNumber")+' title="Sort by Job Announcement Number" href="" ng-click="setPredicate(\'AnnouncementNumber\')"><abbr title="Vacancy Announcment Number">Vac #</abbr>'+a("AnnouncementNumber",alphaIcons)+"</a></dt></dl>",e+="</div>",e+='<ul class="usajobs-jobs-table-list list-unstyled">',e+='<li class="alert alert-info" ng-click="clearFilters()" ng-hide="jobs.resolved">',e+='<i class="fa fa-lg fa-circle-o-notch fa-spin"></i> Getting <strong>{{jobs.orgName}}</strong> job openings from <a ng-href="{{org.orgSearchUrl}}" target="_blank">USAJobs.gov</a>',e+="</li>",e+='<li class="alert alert-warning" ng-show="jobs.resolved && jobs.JobData.length === 0">',e+='<p><i class="fa fa-lg fa-fw fa-times-circle"></i>  No <strong>{{jobs.orgName}}</strong> job openings were found.</p>',e+='<p><a ng-href="{{jobs.orgSearchUrl}}" target="_blank"><i class="fa fa-lg fa-fw fa-external-link"></i> Go to USAJobs.gov to set up a saved search to alert you to new job openings.</a></p>',e+="</li>",e+='<li class="alert alert-danger" ng-click="clearFilters()" ng-show="jobs.JobData.visibleCount === 0 && jobs.JobData.filterStatus.active">',e+='<i class="fa fa-lg fa-times-circle"></i> No jobs match your current filter criteria <span class="btn btn-danger"><i class="fa fa-close"></i> Clear filters</span>',e+="</li>",e+='<li class="usajobs-jobs-table-list-item container-fluid" ng-repeat="job in jobs.JobData | orderBy:predicate:reverse" ng-show="job.visible">',e+='<h5 class="usajobs-jobs-table-list-item-title"><a ng-href="{{job.ApplyOnlineURL}}" target="_blank" title="Open this job announcement on USAJobs.gov">{{ job.title }}<i class="fa fa-fw fa-external-link"></i>',e+="</a></h5>",e+='<div class="row usajobs-table-item-job-details">',e+='<dl class="col-xs-12 col-sm-3 col-md-2 col-lg-2 small"><dt>Location</dt><dd ng-repeat="loc in job.locationArrayCompact track by $index" title="{{ loc }}">{{ loc }}</dd></dl>',e+='<dl class="col-xs-12 col-sm-3 col-md-2 col-lg-2 small"><dt>Salary</dt><dd>{{ job.salaryRange }}<span ng-show="job.hourly()">/hour</span></dd></dl>',e+='<dl class="col-xs-12 col-sm-2 col-md-2 col-lg-2 small"><dt>Grade</dt><dd>{{ job.gradeRangeDesc() }}</dd></dl>',e+='<dl class="col-xs-12 col-sm-2 col-md-2 col-lg-2 small"><dt>Closes</dt><dd title="{{ job.EndDate }}">{{ job.endDateDescription }}</dd></dl>',e+='<dl class="col-xs-12 col-sm-2 col-md-2 col-lg-2 small"><dt>Opened</dt><dd>{{ job.StartDate }}</dd></dl>',e+='<dl class="hidden-xs hidden-sm hidden-md col-lg-2 small"><dt><abbr title="Vacancy Announcment Number">Vac</abbr></dt><dd title="{{job.AnnouncementNumber}}">{{ job.AnnouncementNumber }}</dd></dl>',e+='<div class="col-xs-12 col-sm-12 col-md-2 col-lg-2 clearfix"><a class="hidden-print small text-muted" ng-click="job.toggleDescription()"><i class="fa fa-fw" ng-class="{ \'fa-plus-square-o\': !job.showDescription, \'fa-minus-square-o\': job.showDescription }"></i>Job Summary</a></div>',e+='<dl class="col-xs-12 col-sm-12 col-md-10 col-lg-10 small" ng-show="job.showDescription"><dt class="sr-only visible-print-block">Job Summary</dt><dd><strong class="visible-xs-inline visible-sm-inline visible-md-inline">Vacancy Number: {{job.AnnouncementNumber}}<br /></strong> {{ job.JobSummary }}</dd></dl>',e+="</div>",e+="</li></ul>",e+="</div></div>"}function e(){return"<p class=\"usajobs-vac-count text-center\" ng-class=\"{'bg-clear': filterStatus.active, 'text-primary': filterStatus.active, 'bg-danger': jobs.JobData.visibleCount === 0 && filterStatus.active, 'text-danger': jobs.JobData.visibleCount === 0 && filterStatus.active}\">"+'<span ng-show="filterStatus.active"><strong>{{ jobs.JobData.visibleCount }}</strong> vacanc{{ jobs.JobData.visibleCount == 1 ? "y" : "ies"}} match{{ jobs.JobData.visibleCount == 1 ? "es" : ""}} your filter criteria</strong></span><span ng-hide="filterStatus.active">&nbsp<i class="fa fa-fw fa-search" style="color: #ccc"></i>&nbsp</span></p>'}a.put("job-info.html",b()),a.put("job-filter.html",c()),a.put("job-table.html",d()),a.put("vacancy-count.html",e())}angular.module("UsaJobsApp").run(a),a.$inject=["$templateCache"]}(),function(){function a(a,b,c,d,e){function f(){this.query({NumberOfJobs:250,OrganizationID:this.orgCode})}function g(c){this.resolved=!1,this.JobData.length=0,e.jobs.queryStarted(),a.get(b.usaJobs.baseUrl,{params:c}).success(h)}function h(a){i(a),r.resolved=!0,e.jobs.available()}function i(a){angular.forEach(a.JobData,function(a,b){r.JobData.push(new d(a))},this),k(r.JobData),j()}function j(){var a=!1;angular.forEach(r.JobData,function(b){b.hasAlphaGrades()&&(a=!0)}),r.hasAlphaGrades=a}function k(a){var b=[],d=[];a.locations={},a.states={},a.locMaxJobCount=0,a.locMinJobCount=0,angular.forEach(a,function(a){Array.prototype.push.apply(b,a.locationArray)}),b=c(b),angular.forEach(b,function(b){a.locations[b]={name:b,jobs:[]},d.push(b.replace(/.*,\s/,""))}),angular.forEach(a,function(b){angular.forEach(a.locations,function(a,c){b.Locations.indexOf(c)>-1&&a.jobs.push(b)})}),angular.forEach(a.locations,function(b,c){b.jobs.length>a.locMaxJobCount&&(a.locMaxJobCount=b.jobs.length),b.jobs.length>0&&b.jobs.length<a.locMinJobCount&&(a.locMinJobCount=b.jobs.length)}),angular.forEach(d,function(b){a.states[b]={name:b,jobs:[]}}),angular.forEach(a.states,function(b,c){angular.forEach(a,function(a){a.Locations.indexOf(c)>-1&&b.jobs.push(a)})})}function l(){var a=[];return 0===this.JobData.length?0:(angular.forEach(this.JobData,function(b){a.push(b.gradeHighest())},this),Math.max.apply(this,a))}function m(){var a=[];return 0===this.JobData.length?0:(angular.forEach(this.JobData,function(b){a.push(b.gradeLowest())},this),Math.min.apply(this,a))}function n(){var a=[];return 0===this.JobData.length?0:(angular.forEach(this.JobData,function(b){a.push(b.salaryHighest())},this),Math.max.apply(this,a))}function o(){var a=[];return 0===this.JobData.length?0:(angular.forEach(this.JobData,function(b){a.push(b.salaryLowest())},this),Math.min.apply(this,a))}function p(){var a=[];return 0===jobs.length?0:(angular.forEach(jobs,function(a){grades.push(a.PayPlan)}),c(a))}function q(){var a=[];return angular.forEach(this.JobData,function(b){a.push(b.Series)}),c(a)}var r=this;this.JobData=[],this.resolved=!1,this.orgCode="",this.orgName="",this.orgSearchUrl="",this.getJobs=f,this.query=g,this.getMaxGrade=l,this.getMinGrade=m,this.getMaxSalary=n,this.getMinSalary=o,this.getPayPlans=p,this.getSeriesList=q}function b(a,b,c){function d(d){var e=b(),f=c.usaJobs.dateFormat;angular.extend(this,d),this.daysRemaining=b(this.EndDate,f).diff(e,"days"),this.daysOpen=b(e).diff(b(this.StartDate,f),"days"),this.endDateDescription=a("datedescription")(this.EndDate),this.salaryRange=a("trailingzeroes")(this.SalaryMin+" to "+this.SalaryMax),this.salaryMaxInt=parseInt(this.SalaryMax.replace("$","")),this.salaryMinInt=parseInt(this.SalaryMin.replace("$","")),this.title=this.JobTitle,this.locationArray=this.Locations.split(/;/g),this.locationArrayCompact=[],angular.forEach(this.locationArray,function(b){this.locationArrayCompact.push(a("stateAbbreviation")(b))},this),this.concatenatedValues="",angular.forEach(d,function(a){this.concatenatedValues+=a+" | "},this)}function e(){this.showDescription=!this.showDescription}function f(a){angular.isDefined(a)?this.visible=a(this):this.visible=!0}function g(){return"Per Hour"===this.SalaryBasis}function h(){return"Per Year"===this.SalaryBasis}function i(){var b=this.gradeLowest(),c=this.gradeHighest();return this.hasAlphaGrades()||(b=a("grade")(b),c=a("grade")(c)),this.PayPlan+" "+b+(b!==c?" to "+c:"")}function j(){return this.Grade.split("/")[0]}function k(){var a=this.Grade.split("/")[1];return a===this.gradeLowest()?this.gradeLowest():a}function l(){return t(this.gradeLowest())}function m(){return t(this.gradeHighest())}function n(){return/[a-z]/gi.test(this.Grade)}function o(){return s(this.SalaryMin)}function p(){return s(this.SalaryMax)}function q(a,b){var c=this.salaryLowest(),d=this.salaryHighest();return(c>=a||d>=a)&&(b>=d||b>=c)}function r(a,b){var c=this.gradeLowestInt(),d=this.gradeHighestInt();return(c>=a||d>=a)&&(b>=d||b>=c)}function s(a){return parseFloat(a.replace(/[$,a-z]/gi,""))}function t(a){var b=parseInt(a);return isFinite(b)?b:0}return d.prototype.visible=!0,d.prototype.showDescription=!1,d.prototype.setVisibleWithPredicate=f,d.prototype.hourly=g,d.prototype.salaried=h,d.prototype.gradeRangeDesc=i,d.prototype.gradeLowest=j,d.prototype.gradeHighest=k,d.prototype.gradeLowestInt=l,d.prototype.gradeHighestInt=m,d.prototype.hasAlphaGrades=n,d.prototype.salaryLowest=o,d.prototype.salaryHighest=p,d.prototype.salaryInRange=q,d.prototype.gradeInRange=r,d.prototype.toggleDescription=e,d}function c(){return{restrict:"E",scope:{},controller:"JobDataFilter",templateUrl:"job-filter.html"}}function d(a,b,c,d){function e(){if(0!==a.jobs.JobData.length){var b=a.jobs.getMaxGrade(),c=a.jobs.getMinGrade(),d=Math.ceil(a.jobs.getMaxSalary()),e=Math.floor(a.jobs.getMinSalary());a.filters.salaryFilter.setSalaryRange(e,d),a.filters.gradeFilter.setGradeRange(c,b)}}function f(){a.filters.gradeFilter.reset(),a.filters.salaryFilter.reset(),a.filters.payFilter.reset(),a.filters.stringFilter.reset(),a.filters.state.reset(),c.filters.cleared(),a.filter()}function g(b){return a.filters.gradeFilter.predicate(b)&&a.filters.salaryFilter.predicate(b)&&a.filters.payFilter.predicate(b)&&a.filters.stringFilter.predicate(b)&&a.filters.state.predicate(b)}function h(){a.filters.setFiltersActive(),c.filters.changed(g),a.jobs.JobData.visibleCount=k()}function i(){a.showAdvancedFilters=!a.showAdvancedFilters}function j(){this.filterStatus.active=this.gradeFilter.isActive()||this.salaryFilter.isActive()||this.payFilter.isActive()||this.stringFilter.isActive()||this.state.isActive(),this.filterStatus.active&&c.filters.cleared()}function k(){var b=0;return angular.forEach(a.jobs.JobData,function(a){a.visible&&b++}),b}function l(){a.$watch("filters.salaryFilter.min",n),a.$watch("filters.salaryFilter.max",n),a.$watch("filters.gradeFilter.min",n),a.$watch("filters.gradeFilter.max",n),c.jobs.onAvailable(o),c.filters.onClear(f),angular.element(document).keyup(m)}function m(b){27==b.keyCode&&(a.reset(),a.$apply())}function n(){a.filter()}function o(){a.update(),a.reset(),a.filter()}a.jobs=d,a.showAdvancedFilters=!1,a.filters={},a.filters.filterStatus=a.jobs.JobData.filterStatus={active:!1},a.filters.stringFilter={value:"",predicate:function(a){return""===this.value?!0:a.concatenatedValues.indexOf(this.value)>-1},reset:function(b){this.value="",b&&a.filter()},isActive:function(){return this.value.length>0}},a.filters.gradeFilter={min:0,max:15,lowest:0,highest:15,isDisabled:!1,predicate:function(a){return this.isDisabled?!0:a.gradeInRange(this.min,this.max)},reset:function(a){this.min=this.lowest,this.max=this.highest},isActive:function(){return!angular.equals(this.min,this.lowest)||!angular.equals(this.max,this.highest)},setGradeRange:function(b,c){a.jobs.hasAlphaGrades?(this.isDisabled=!0,this.lowest=0,this.highest=0):(this.lowest=b,this.highest=c)}},a.filters.salaryFilter={min:0,max:1e5,lowest:0,highest:1e5,predicate:function(a){return a.salaryInRange(this.min,this.max)},reset:function(b){this.min=this.lowest,this.max=this.highest,b&&a.filter()},isActive:function(){return this.min>=this.lowest+1||this.max!==this.highest},setSalaryRange:function(a,b){this.highest=b,this.lowest=a,this.max=b>1e5?1e5*Math.ceil(b/1e5):b,this.min=Math.floor(a)}},a.filters.payFilter={hourly:"hourly",salaried:"salaried",all:"all",selection:"all",predicate:function(a){return this.selection===this.all?!0:this.selection===this.hourly?a.hourly():this.selection===this.salaried?a.salaried():!0},reset:function(b){this.selection=this.all,b&&a.filter()},isActive:function(){return!angular.equals(this.selection,this.all)}},a.filters.state={value:null,predicate:function(a){return null===this.value?!0:a.Locations.indexOf(this.value.name)>-1?!0:!1},reset:function(b){this.value=null,b&&a.filter()},isActive:function(){return null!==this.value}},a.update=e,a.reset=f,a.predicate=g,a.filter=h,a.toggleAdvancedFilters=i,a.filters.setFiltersActive=j,l()}function e(){return{restrict:"E",scope:{},controller:"vacancyCountDescController",templateUrl:"vacancy-count.html"}}function f(a,b){a.jobs=b,a.filterStatus=a.jobs.JobData.filterStatus,a.visibleCount=a.jobs.JobData.visibleCount}function g(){return{restrict:"E",scope:{},controller:"jobInfoController",templateUrl:"job-info.html"}}function h(a,b){function c(){a.jobs.getJobs()}a.jobs=b,a.refresh=c}angular.module("UsaJobsApp.Data",["UsaJobsApp.Settings","UsaJobsApp.Filters","UsaJobsApp.Utilities","MomentModule","LeafletModule"]),angular.module("UsaJobsApp.Data").service("Jobs",a),angular.module("UsaJobsApp.Data").factory("Job",b),angular.module("UsaJobsApp.Data").directive("jobFilter",c),angular.module("UsaJobsApp.Data").controller("JobDataFilter",d),angular.module("UsaJobsApp.Data").directive("vacancyCountDesc",e),angular.module("UsaJobsApp.Data").controller("vacancyCountDescController",f),angular.module("UsaJobsApp.Data").directive("jobInfo",g),angular.module("UsaJobsApp.Data").controller("jobInfoController",h),a.$inject=["$http","settings","unique","Job","eventService"],b.$inject=["$filter","moment","settings"],d.$inject=["$scope","$filter","eventService","Jobs"],f.$inject=["$scope","Jobs"],h.$inject=["$scope","Jobs"]}(),function(){function a(a,b){function c(b){angular.extend(this,b),a.geocode(this)}function d(){b.geodata.available(this)}function e(a){this.noGeodataReason=a,b.geodata.notAvailable(this)}function f(a){this.geodata=a,this.geodataAvailable()}function g(){var a,b=!1;for(a=0;a<this.jobs.length;a++)if(this.jobs[a].visible===!0){b=!0;break}return b}function h(){var a=0;return angular.forEach(this.jobs,function(b){b.visible&&a++}),a}return c.prototype.geodataAvailable=d,c.prototype.setGeodata=f,c.prototype.hasNoGeodata=e,c.prototype.visible=g,c.prototype.countVisible=h,c}function b(a,b,c,d,e){function f(a){var b;(b=c.getLocation(a.name))?a.setGeodata(b):this._addToQueue(a),k||g()}function g(){var a='<a href="'+d.geocoding.infoURL+'" ';a+='title="Job locations plotted using '+d.geocoding.name+' Geocoding API" ',a+='target="_blank">',a+=d.geocoding.name,a+="</a>",e.location.setAttribution(a),k=!0}function h(a){this.queue.push(a),this._run()}function i(a){var c=this;(!c.isRunning||c.isRunning&&a)&&(c.isRunning=!0,c.queue.length>0?b(function(){c._geocodeRun(),c._run(!0)},d.geocoding.rateLimit):c.isRunning=!1)}function j(){var b=this,e=b.queue.shift(),f={};f.promise=a.get(d.geocoding.query(e.name)),f.promise.success(function(a,b,g){var h;a.error_message&&"OVER_QUERY_LIMIT"===a.status?(console.warn("Error Geocoding "+e.name+"\r\nStatus Message: "+a.status+"\r\nError Message: "+a.error_message),e.hasNoGeodata("Geolocation service over query limit")):0===a.results.length?e.hasNoGeodata("Location not found"):(h=d.geocoding.normalizeResponse(a),h.name=e.name,angular.extend(f,h),e.setGeodata(f),c.addLocations(h))}),f.promise.error(function(a){console.error(a)})}var k=!1;this.queue=[],this.isRunning=!1,this.geocode=f,this._run=i,this._geocodeRun=j,this._addToQueue=h}function c(a){function b(a){var b=JSON.parse(a),c={},d=moment().subtract(90,"days");return angular.forEach(b,function(a,b){a.date&&moment(a.date).isAfter(d)&&(c[b]=a)}),c}function c(){var a=[];return angular.forEach(this.geodata,function(b){a.push(b.name)},this),a}function d(a){return this.geodata[a]}function e(){var a=[].slice.call(arguments,0);j.push(a),f()}function f(){var a,b={};if(!k){for(k=!0;j.length>0;)a=j.shift(),angular.forEach(a,function(a){h(a)||(b[a.name]=a)},this),angular.extend(i,b);g(i),k=!1}}function g(a){this.geodata=a,angular.isDefined(window.localStorage)&&(localStorage.geodataCache=JSON.stringify(a))}function h(a){return window.localStorage?-1!==localStorage.geodataCache.indexOf(a.name):!1}var i,j=[],k=!1;this.geodata=i=function(){return angular.isUndefined(window.localStorage)?{}:angular.isDefined(localStorage.geodataCache)?b(localStorage.geodataCache):(localStorage.geodataCache=JSON.stringify({}),{})}(),this.locNameArr=c,this.getLocation=d,this.addLocations=e}angular.module("UsaJobsApp.Location",["UsaJobsApp.Settings","MomentModule","LeafletModule"]),angular.module("UsaJobsApp.Location").factory("JobLocation",a),angular.module("UsaJobsApp.Location").service("geocodeService",b),angular.module("UsaJobsApp.Location").service("geodataCache",c),a.$inject=["geocodeService","eventService"],b.$inject=["$http","$timeout","geodataCache","settings","eventService"],c.$inject=["$timeout","moment"]}(),function(){function a(a,b,c,d){function e(b){b!==a.predicate?(a.predicate=b,a.reverse=!1):a.reverse=!a.reverse}function f(){"salaryMinInt"===a.predicate?(a.predicate="salaryMaxInt",a.reverse=!0):"salaryMaxInt"===a.predicate?(a.predicate="salaryMinInt",a.reverse=!1):(a.predicate="salaryMaxInt",a.reverse=!0)}function g(){d.filters.clear()}a.jobs=c,a.filterStatus=a.jobs.JobData.filterStatus,a.predicate="daysRemaining",a.reverse=!1,a.setPredicate=e,a.setSalaryPredicate=f,a.clearFilters=g}function b(){return{restrict:"E",controller:"jobTableCtrl",scope:{},templateUrl:"job-table.html"}}angular.module("UsaJobsApp.JobTable",["UsaJobsApp.Data"]),angular.module("UsaJobsApp.JobTable").controller("jobTableCtrl",a),angular.module("UsaJobsApp.JobTable").directive("jobTable",b),a.$inject=["$scope","$filter","Jobs","eventService"]}(),function(){function a(a,b,c,d,e,f){function g(){angular.forEach(a.jobs.JobData.locations,function(b,c){a.geodataStatus.addPending(),a.jobs.JobData.locations[c]=new d(b)}),a.locations=a.jobs.JobData.locations}function h(b,c){k(c),a.geodataStatus.addResolved(),a.map.allMarkersBounds.extend([c.geodata.lat,c.geodata.lon])}function i(b,c){a.locationsNoGeodata.push(c),a.locationsNoGeodata.updateJobCount(),a.geodataStatus.addResolved()}function j(b,c){angular.isDefined(a.map.attributionControl)&&a.map.attributionControl.addAttribution(c)}function k(b){var c;(c=a.markerLookup[b.name])?(a.removeMarker(c),delete c,a.addMarker(b)):a.addMarker(b)}function l(){angular.forEach(a.locations,function(a){a.geodata.$resolved&&k(a)})}function m(){var b=[],c=[];angular.forEach(a.locations,function(d){var e,f=d.countVisible(),g=d.visible();(e=a.markerLookup[d.name])&&(f!==e.jobCount&&f>0&&a.updatePopup(e),!g&&e.visible?(e.visible=!1,c.push(e)):g&&!e.visible&&(e.visible=!0,b.push(e)))},this),a.hideMarkers(c),a.showMarkers(b)}function n(b){var d;d=c.marker([b.geodata.lat,b.geodata.lon],{title:b.name,icon:e.markerIcon}),d.jobLocation=b,d.visible=d.jobLocation.visible()||!0,a.updatePopup(d),d.jobCount=b.jobs.length,a.markerLookup[b.name]=d,a.markers.push(d),d.visible&&a.map.markerLayer.addLayer(d)}function o(a){var b=a.getPopup();b?b.setContent(e.popups.contentForLoc(a.jobLocation)):(b=e.popups.popupForLoc(a.jobLocation),a.bindPopup(b).openPopup())}function p(b){a.map.markerLayer.removeLayer(b),a.markers.splice(a.markers.indexOf(b),1)}function q(b){a.map.removeMarkers(b)}function r(b){a.map.addMarkers(b)}function s(){a.map.resetAllMarkersBounds(),a.map.markerLayer.clearLayers(),a.jobCountLayer.clearLayers(),a.markers.length=0,a.markerLookup={},a.geodataStatus.reset(),a.locationsNoGeodata.length=0}a.jobs=f,a.markers=[],a.markerLookup={},a.locations=[],b.jobs.onAvailable(g),b.jobs.onUpdateVisible(m),b.jobs.onQueryStarted(s),b.geodata.onAvailable(h),b.geodata.onNotAvailable(i),b.location.onSetAttribution(j),a.updateMarkers=l,a.updateVisible=m,a.addMarker=n,a.updatePopup=o,a.removeMarker=p,a.hideMarkers=q,a.showMarkers=r,a.resetMarkers=s}function b(a,b,c,d,e,f,g){return{restrict:"E",controller:"JobMapController",scope:{},link:function(h,i){function j(){elStr="",elStr+='<div class="geodata-status center-block" ng-show="geodataStatus.loading">',elStr+='<i class="fa fa-fw fa-circle-o-notch fa-spin"></i> {{ geodataStatus.resolvedCount }} of {{ geodataStatus.pendingCount }} job locations mapped',elStr+="</div>";var a=angular.element(elStr);i.append(a)}function k(){var a="";h.locationsNoGeodata=[],h.locationsNoGeodata.maximized=!1,h.locationsNoGeodata.jobCount=0,h.locationsNoGeodata.updateJobCount=function(){var a=0;angular.forEach(this,function(b){a+=b.jobs.length}),this.jobCount=a},a+='<div class="loc-no-geodata-list" ng-show="locationsNoGeodata.length > 0">',a+="<h5>{{ locationsNoGeodata.jobCount }} Job<span ng-hide=\"locationsNoGeodata.jobCount === 1\">s</span> Not on Map <small><a ng-click=\"locationsNoGeodata.maximized = !locationsNoGeodata.maximized\">{{locationsNoGeodata.maximized ? 'Hide' : 'Show' }}</a></small></h5>",a+='<div ng-show="locationsNoGeodata.maximized" class="loc-no-geodata-list-container">',a+='<div ng-repeat="location in locationsNoGeodata">',a+='<h6 class="small bold">{{location.name}}</h6>',a+='<p class="alert alert-warning small">{{ location.noGeodataReason }}</p>',a+='<ul class="loc-popup-job-list list-unstyled">',a+='<li class="loc-popup-job-list-item clearfix" ng-repeat="job in location.jobs">',a+='<a class="loc-popup-job-list-item-link" ng-href="{{ job.ApplyOnlineURL }}" target="_blank" title="{{ job.JobTitle }}\r\nView this job announcement on USAJobs.gov">{{ job.JobTitle }}</a>',
a+='<span class="loc-popup-job-list-item-tag small" title="Grade">{{job.PayPlan + \'&#8209;\' + job.Grade}}</span>',a+='<span class="loc-popup-job-list-item-tag small" title="Salary">{{job.SalaryMin + \'&#8209;\' + job.SalaryMax | trailingzeroes}}</span>',a+="</li>",a+="</ul><hr>",a+="</div>",a+="</div>",a+="</div>",i.append(angular.element(a))}function l(){function a(){v.userHasTouchedMap=!0}function f(){v.closePopup()}function j(a){var b;if(h.mapOptions.markerClustering)v.markerLayer.addLayers(a);else for(b=0;b<a.length;b++)v.addLayer(a[b])}function k(a){var b;if(h.mapOptions.markerClustering)v.markerLayer.removeLayers(a);else for(b=0;b<a.length;b++)v.removeLayer(a[b])}function l(){h.bounds?v.fitBounds(h.bounds):v.setView(h.mapOptions.center,h.mapOptions.zoom)}function m(){v.fitBounds(v.allMarkersBounds,{paddingTopLeft:[55,35]})}function n(){v.allMarkersBounds=new b.latLngBounds(v.startBounds.getSouthWest(),v.startBounds.getNorthEast())}function o(){var a=!1;return v.markerLayer.eachLayer(function(b){!v.inBounds(b.jobLocation)&&b.jobLocation.visible()&&(a=!0)}),a}function p(a){return v.getBounds().contains([a.geodata.lat,a.geodata.lon])}function q(a){return v.startBounds.contains([a.geodata.lat,a.geodata.lon])}function r(){return v.getCenter().distanceTo(h.mapOptions.center)<2e4}function s(){return v.getZoom()===v.options.zoom}function t(){function a(a){function b(a){return a.startWeight*(c>h.mapOptions.zoom?c-h.mapOptions.zoom+1:1)}var c=h.map.getZoom();c>=4&&angular.forEach(h.jobCountLayer._layers,function(a){a.setRadius(a.startRadius*(c-h.mapOptions.zoom)),a.options.fillOpacity=a.startOpacity-a.startOpacity/(h.mapOptions.maxZoom-h.mapOptions.minZoom)*(c-h.mapOptions.zoom),a.options.weight=b(a),a._updateStyle()}),4>c&&angular.forEach(h.jobCountLayer._layers,function(a){a.options.fillOpacity=0,a._updateStyle()})}angular.isUndefined(h.jobCountLayer)?(h.jobCountLayer=b.layerGroup(),v.addLayer(h.jobCountLayer)):h.jobCountLayer.clearLayers(),v.on("zoomend",a)}function u(a){function b(a,b,c){var d,e,f=h.jobs.JobData.locMaxJobCount,g=a.jobs.length,i=c-b;return d=g/f,e=b+i*d}var c;c=L.circleMarker([a.geodata.lat,a.geodata.lon],{title:a.name,zIndexOffset:-a.jobs.length,radius:Math.round(b(a,0,22)),stroke:!1,clickable:!1,fill:!0,fillColor:"#C4721F",fillOpacity:b(a,.5,.15)}),c.location=a,c.startRadius=c._radius.valueOf(),c.startOpacity=c.options.fillOpacity.valueOf(),c.startWeight=c.options.weight.valueOf(),h.jobCountLayer.addLayer(c)}var v,w;return v=b.map(i[0],{center:h.mapOptions.center,zoom:h.mapOptions.zoom,attributionControl:!1,zoomControl:!1,scrollWheelZoom:h.mapOptions.scrollWheelZoom,worldCopyJump:!0}),v.startBounds=v.getBounds(),v.allMarkersBounds=v.getBounds(),v.userHasTouchedMap=!1,w=b.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{subdomains:"abc",detectRetina:!0,attribution:'<a target="_blank" href="http://www.openstreetmap.org/copyright" title="Map data &#169;OpenStreetMap contributors">&#169; OpenStreetMap contributors</a>',maxZoom:h.mapOptions.maxZoom,minZoom:h.mapOptions.minZoom}),w.addTo(v),v.addMarkers=j,v.removeMarkers=k,v.resetMapView=l,v.mapViewCentered=r,v.mapAtDefaultZoom=s,v.inBounds=p,v.inStartBounds=q,v.showAllMarkers=m,v.resetAllMarkersBounds=n,v.markersOutsideBounds=o,h.bounds&&v.fitBounds(h.bounds),h.mapOptions.markerClustering?v.markerLayer=new b.markerClusterGroup({maxClusterRadius:35,showCoverageOnHover:!1,iconCreateFunction:function(a){return new b.DivIcon({className:"clusterIcon",html:e.cluster.clusterContent(a)})}}):v.markerLayer=new b.LayerGroup,v.addLayer(v.markerLayer),h.mapOptions.jobCountOverlay&&(t(),g.geodata.onAvailable(function(a,b){u(b)})),b.Browser.mobile||b.Browser.touch||v.addControl(b.control.zoom({position:"bottomleft"})),angular.forEach([c,d],function(a){v.addControl(new a)}),v.on("zoomstart",f),v.on("mousemove",a),v.on("mousedown",a),v}i.addClass("usajobs-map"),h.mapOptions=f.map,h.geodataStatus={loading:!1,resolvedCount:0,pendingCount:0,addPending:function(){this.pendingCount+=1,this.loading=!0},addResolved:function(){this.resolvedCount+=1,this.resolvedCount===this.pendingCount&&(this.loading=!1)},reset:function(){this.resolvedCount=0,this.pendingCount=0}},j(),k(),a(i.contents())(h),h.map=l()}}}function c(a,b,c,d){function e(a){var b,c,d,e,f,g;for(c=Math.min(a.getChildCount(),9),d=3,e=angular.element("<div/>"),f=angular.element("<div/>").addClass("markercluster-icon-img-wrapper").css("margin-top",this.contentTopMargin(c,d)).attr("title","Zoom to these locations: \r\n\r\n"+this.locationsInCluster(a).join("\r\n")),b=0;c>b;b++)g=angular.element("<img />").addClass("markercluster-icon-img").attr("src",this.miniIconURL),f.append(g);return e.append(f),e.html()}function f(a){function c(a){var b,e,f,g;for(b=0;b<a._markers.length;++b)e=a._markers[b],g=e.jobCount,f=e.options.title+" ("+g+" vacanc"+(1===g?"y":"ies")+")",d.push(f);for(b=0;b<a._childClusters.length;b++)c(a._childClusters[b])}var d=[];return c(a),b(d).sort()}function g(a,b){var c,d,e;return c=12,d=4,e=c,a>b&&2*b>=a?e=c-d:a>2*b&&(e=c-2*d),e.toString()+"px"}function h(a){var b;return b=c.popup({maxWidth:250,autoPanPaddingTopLeft:c.point(12,78),autoPanPaddingBottomRight:c.point(12,36)}),b.setContent(this.contentForLoc(a)),b}function i(b){var c,d,e,f,g,h,i,j,k,l,m,n;return c=b.jobs,d=b.countVisible(),f=c.length,e=f+" vacanc"+(1===f?"y":"ies"),f!==d&&(e+=", "+d+" matching filters"),g=angular.element("<div class='loc-popup' />"),h=angular.element("<h5 class='loc-popup-title bold'/>").text(b.name),i=angular.element("<span class='loc-popup-job-count small'/>").text(e),j=angular.element('<ul class="loc-popup-job-list list-unstyled" />'),angular.forEach(c,function(b){b.visible&&(k=angular.element('<li class="loc-popup-job-list-item clearfix"></li>'),l=angular.element('<a class="loc-popup-job-list-item-link"></a>').attr("href",b.ApplyOnlineURL).attr("target","_blank").html(b.JobTitle.replace(/-/g,"&#8209;")).attr("title",b.JobTitle+"\r\nView this job announcement on USAJobs.gov"),n=angular.element('<span class="loc-popup-job-list-item-tag small"></span>').html(b.PayPlan+"&#8209;"+b.Grade).attr("title","Grade"),m=angular.element('<span class="loc-popup-job-list-item-tag small"></span>').html(a("trailingzeroes")(b.SalaryMin+"&#8209;"+b.SalaryMax)).attr("title","Salary"),k.append(l),k.append(n),k.append(m),j.append(k))},this),g.append(h).append(i).append(j),g.html()}this.markerIcon=c.icon(d.assets.jobLocation),this.cluster={miniIconURL:d.assets.jobLocation.miniIconUrl,clusterContent:e,locationsInCluster:f,contentTopMargin:g},this.popups={popupForLoc:h,contentForLoc:i}}function d(a){return a.Control.extend({options:{position:"topright"},onAdd:function(b){function c(a){$(a).animate({right:"-66"},{duration:250,done:function(a){$(a.elem).hide()}})}function d(a){$(a).show().animate({right:"0"},175)}var e,f,g,h;return e=a.DomUtil.create("div","usajobs-map-viewreset-control"),angular.element(e).attr("title","Reset map view"),f=a.DomUtil.create("div","usajobs-map-reset-icon",e),g=a.DomUtil.create("i","fa fa-4x fa-compass",f),h=a.DomUtil.create("span","usajobs-icon-label",f),$(h).text("Reset"),$(e).hide(),c(e),a.DomEvent.addListener(e,"click",a.DomEvent.stopPropagation).addListener(e,"click",a.DomEvent.preventDefault).addListener(e,"click",function(){b.closePopup(),b.resetMapView()}),b.on("moveend",function(a){a.target.mapViewCentered()?c(e):d(e)}),e}})}function e(a,b){return a.Control.extend({options:{position:"topleft"},onAdd:function(c){function d(a,b){c.inStartBounds(b)||(g(h),c.markersOutsideStartView=!0,b.outsideMapStartBounds=!0)}function e(){f(h)}function f(a){$(a).animate({left:"-66"},{duration:250,done:function(a){$(a.elem).hide()}})}function g(a){$(a).show().animate({left:"0"},175)}var h,i,j;return h=a.DomUtil.create("div","usajobs-map-showall-control"),angular.element(h).attr("title","Zoom out to all job locations"),i=a.DomUtil.create("div","usajobs-map-showall-icon center-block",h),a.DomUtil.create("i","fa fa-fw",i),a.DomUtil.create("i","fa fa-fw fa-1x fa-thumb-tack top-pin",i),a.DomUtil.create("i","fa fa-fw",i),a.DomUtil.create("br","",i),a.DomUtil.create("i","fa fa-fw fa-1x fa-thumb-tack left-pin",i),a.DomUtil.create("i","fa fa-fw fa-arrows-alt center-arrows",i),a.DomUtil.create("i","fa fa-fw fa-1x fa-thumb-tack right-pin",i),a.DomUtil.create("br","",i),a.DomUtil.create("i","fa fa-fw",i),a.DomUtil.create("i","fa fa-fw fa-1x fa-thumb-tack bottom-pin",i),a.DomUtil.create("i","fa  fa-fw",i),j=a.DomUtil.create("span","usajobs-icon-label",i),$(j).text("Show All"),$(h).hide(),f(h),b.geodata.onAvailable(d),b.jobs.onQueryStarted(e),c.on("zoomend",function(a){a.target.mapAtDefaultZoom()&&a.target.markersOutsideStartView?g(h):a.target.markersOutsideBounds()?g(h):f(h)}),c.on("moveend",function(a){a.target.markersOutsideBounds()&&g(h)}),a.DomEvent.addListener(h,"click",a.DomEvent.stopPropagation).addListener(h,"click",a.DomEvent.preventDefault).addListener(h,"click",function(){c.closePopup(),c.showAllMarkers()}),h}})}angular.module("UsaJobsApp.Map",["LeafletModule","UsaJobsApp.Settings","UsaJobsApp.Utilities","UsaJobsApp.Location","UsaJobsApp.Data"]),angular.module("UsaJobsApp.Map").controller("JobMapController",a),angular.module("UsaJobsApp.Map").directive("jobMap",b),angular.module("UsaJobsApp.Map").factory("mapResetControl",d),angular.module("UsaJobsApp.Map").factory("mapShowAllControl",e),angular.module("UsaJobsApp.Map").service("markers",c),a.$inject=["$scope","eventService","leaflet","JobLocation","markers","Jobs"],b.$inject=["$compile","leaflet","mapResetControl","mapShowAllControl","markers","settings","eventService"],c.$inject=["$filter","unique","leaflet","settings"],d.$inject=["leaflet"],e.$inject=["leaflet","eventService"]}(),function(){function a(){return function(a){var b=a.toString();return b.length<2&&(b="0"+b),b}}function b(){return function(a){return a.replace(/\.0+/g,"")}}function c(a,b){return function(c){var d=a(c,b.usaJobs.dateFormat),e=0===a().diff(d,"days");return e?"today":d.fromNow()}}function d(a){return function(b,c){var d,e;for(d in a)if(e=new RegExp(",.*"+d,"i"),-1!==b.indexOf(d))return"AP"===c?b.replace(e,", "+a[d].apStyle):b.replace(e,", "+a[d].postal);return b}}function e(){return{Alabama:{postal:"AL",apStyle:"Ala."},Alaska:{postal:"AK",apStyle:"Alaska"},Arizona:{postal:"AZ",apStyle:"Ariz."},Arkansas:{postal:"AR",apStyle:"Ark."},California:{postal:"CA",apStyle:"Calif."},Colorado:{postal:"CO",apStyle:"Colo."},Connecticut:{postal:"CT",apStyle:"Conn."},Delaware:{postal:"DE",apStyle:"Del."},"District of Columbia":{postal:"DC",apStyle:"D.C."},Florida:{postal:"FL",apStyle:"Fla."},Georgia:{postal:"GA",apStyle:"Ga."},Hawaii:{postal:"HI",apStyle:"Hawaii"},Idaho:{postal:"ID",apStyle:"Idaho"},Illinois:{postal:"IL",apStyle:"Ill."},Indiana:{postal:"IN",apStyle:"Ind."},Iowa:{postal:"IA",apStyle:"Iowa"},Kansas:{postal:"KS",apStyle:"Kan."},Kentucky:{postal:"KY",apStyle:"Ky."},Louisiana:{postal:"LA",apStyle:"La."},Maine:{postal:"ME",apStyle:"Maine"},Maryland:{postal:"MD",apStyle:"Md."},Massachusetts:{postal:"MA",apStyle:"Mass."},Michigan:{postal:"MI",apStyle:"Mich."},Minnesota:{postal:"MN",apStyle:"Minn."},Mississippi:{postal:"MS",apStyle:"Miss."},Missouri:{postal:"MO",apStyle:"Mo."},Montana:{postal:"MT",apStyle:"Mont."},Nebraska:{postal:"NE",apStyle:"Neb."},Nevada:{postal:"NV",apStyle:"Nev."},"New Hampshire":{postal:"NH",apStyle:"N.H."},"New Jersey":{postal:"NJ",apStyle:"N.J."},"New Mexico":{postal:"NM",apStyle:"N.M."},"New York":{postal:"NY",apStyle:"N.Y."},"North Carolina":{postal:"NC",apStyle:"N.C."},"North Dakota":{postal:"ND",apStyle:"N.D."},Ohio:{postal:"OH",apStyle:"Ohio"},Oklahoma:{postal:"OK",apStyle:"Okla."},Oregon:{postal:"OR",apStyle:"Ore."},Pennsylvania:{postal:"PA",apStyle:"Pa."},"Rhode Island":{postal:"RI",apStyle:"R.I."},"South Carolina":{postal:"SC",apStyle:"S.C."},"South Dakota":{postal:"SD",apStyle:"S.D."},Tennessee:{postal:"TN",apStyle:"Tenn."},Texas:{postal:"TX",apStyle:"Texas"},Utah:{postal:"UT",apStyle:"Utah"},Vermont:{postal:"VT",apStyle:"Vt."},Virginia:{postal:"VA",apStyle:"Va."},Washington:{postal:"WA",apStyle:"Wash."},"West Virginia":{postal:"WV",apStyle:"W.Va."},Wisconsin:{postal:"WI",apStyle:"Wis."},Wyoming:{postal:"WY",apStyle:"Wyo."}}}angular.module("UsaJobsApp.Filters",["MomentModule"]),angular.module("UsaJobsApp.Filters").filter("grade",a),angular.module("UsaJobsApp.Filters").filter("trailingzeroes",b),angular.module("UsaJobsApp.Filters").filter("datedescription",c),angular.module("UsaJobsApp.Filters").filter("stateAbbreviation",d),angular.module("UsaJobsApp.Filters").constant("stateAbbreviationValues",e()),c.$inject=["moment","settings"],d.$inject=["stateAbbreviationValues"]}(),function(){angular.module("MomentModule",[]).factory("moment",["$window",function(a){return a.moment}]),angular.module("LeafletModule",[]).factory("leaflet",["$window",function(a){return a.L}])}(),function(){angular.module("UsaJobsApp.Utilities",[]),angular.module("UsaJobsApp.Utilities").constant("unique",function(a){var b,c,d=a.concat();for(b=0;b<d.length;++b)for(c=b+1;c<d.length;++c)d[b]===d[c]&&d.splice(c--,1);return d}),angular.module("UsaJobsApp.Utilities").constant("pluralize",function(a,b,c,d){return 1!=a?b+d:b+c})}(),function(){var a=1===angular.version.major&&0===angular.version.minor;angular.module("ui-rangeSlider",[]).directive("rangeSlider",["$document","$filter","$log",function(b,c,d){var e=".rangeSlider",f={disabled:!1,orientation:"horizontal",step:0,decimalPlaces:0,showValues:!0,preventEqualMinMax:!1,attachHandleValues:!1},g=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup",over:"pointerdown",out:"mouseout"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp",over:"MSPointerDown",out:"mouseout"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend",over:"mouseover touchstart",out:"mouseout"},h=g.start+e,i=g.move+e,j=g.end+e,k=g.over+e,l=g.out+e,m=function(a){try{return[a.clientX||a.originalEvent.clientX||a.originalEvent.touches[0].clientX,a.clientY||a.originalEvent.clientY||a.originalEvent.touches[0].clientY]}catch(b){return["x","y"]}},n=function(a){return 0>a?0:a>100?100:a},o=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},p={disabled:"=?",min:"=",max:"=",modelMin:"=?",modelMax:"=?",onHandleDown:"&",onHandleUp:"&",orientation:"@",step:"@",decimalPlaces:"@",filter:"@",filterOptions:"@",showValues:"@",pinHandle:"@",preventEqualMinMax:"@",attachHandleValues:"@"};return a&&(p.disabled="=",p.modelMin="=",p.modelMax="="),{restrict:"A",replace:!0,template:['<div class="ngrs-range-slider">','<div class="ngrs-runner">','<div class="ngrs-handle ngrs-handle-min"><i></i></div>','<div class="ngrs-handle ngrs-handle-max"><i></i></div>','<div class="ngrs-join"></div>',"</div>",'<div class="ngrs-value-runner">','<div class="ngrs-value ngrs-value-min" ng-show="showValues"><div>{{filteredModelMin}}</div></div>','<div class="ngrs-value ngrs-value-max" ng-show="showValues"><div>{{filteredModelMax}}</div></div>',"</div>","</div>"].join(""),scope:p,link:function(a,g,p,q){function r(a){"min"===a?(angular.element(z[0]).css("display","none"),angular.element(z[1]).css("display","block")):"max"===a?(angular.element(z[0]).css("display","block"),angular.element(z[1]).css("display","none")):(angular.element(z[0]).css("display","block"),angular.element(z[1]).css("display","block"))}function s(a){a?y.addClass("ngrs-disabled"):y.removeClass("ngrs-disabled")}function t(){a.min>a.max&&w("min must be less than or equal to max"),angular.isDefined(a.min)&&angular.isDefined(a.max)&&(o(a.min)||w("min must be a number"),o(a.max)||w("max must be a number"),G=a.max-a.min,F=[a.min,a.max],u())}function u(){if(a.modelMin>a.modelMax&&(x("modelMin must be less than or equal to modelMax"),a.modelMin=a.modelMax),(angular.isDefined(a.modelMin)||"min"===a.pinHandle)&&(angular.isDefined(a.modelMax)||"max"===a.pinHandle)){o(a.modelMin)||("min"!==a.pinHandle&&x("modelMin must be a number"),a.modelMin=a.min),o(a.modelMax)||("max"!==a.pinHandle&&x("modelMax must be a number"),a.modelMax=a.max);var b,d,e=n((a.modelMin-a.min)/G*100),f=n((a.modelMax-a.min)/G*100);if(a.attachHandleValues&&(b=e,d=f),a.modelMin=Math.max(a.min,a.modelMin),a.modelMax=Math.min(a.max,a.modelMax),a.filter&&a.filterOptions)a.filteredModelMin=c(a.filter)(a.modelMin,a.filterOptions),a.filteredModelMax=c(a.filter)(a.modelMax,a.filterOptions);else if(a.filter){var g,h,i=a.filter.split(":"),j=a.filter.split(":")[0],k=i.slice().slice(1);k=k.map(function(a){return o(a)?+a:'"'==a[0]&&'"'==a[a.length-1]||"'"==a[0]&&"'"==a[a.length-1]?a.slice(1,-1):void 0}),g=k.slice(),h=k.slice(),g.unshift(a.modelMin),h.unshift(a.modelMax),a.filteredModelMin=c(j).apply(null,g),a.filteredModelMax=c(j).apply(null,h)}else a.filteredModelMin=a.modelMin,a.filteredModelMax=a.modelMax;a.min===a.max&&a.modelMin==a.modelMax?(angular.element(z[0]).css(C,"0%"),angular.element(z[1]).css(C,"100%"),a.attachHandleValues&&(angular.element(A[0]).css(C,"0%"),angular.element(A[1]).css(C,"100%")),angular.element(B).css(C,"0%").css(D,"0%")):(angular.element(z[0]).css(C,e+"%"),angular.element(z[1]).css(C,f+"%"),a.attachHandleValues&&(angular.element(A[0]).css(C,b+"%"),angular.element(A[1]).css(C,d+"%"),angular.element(A[1]).css(D,"auto")),angular.element(B).css(C,e+"%").css(D,100-f+"%"),e>95&&angular.element(z[0]).css("z-index",3))}}function v(c){var d=z[c];d.bind(h+"X",function(f){var g=(0===c?"ngrs-handle-min":"ngrs-handle-max")+"-down",h=(0===c?a.modelMin:a.modelMax)-a.min,k=h/G*100,l=m(f),o=l,p=!1;angular.isFunction(a.onHandleDown)&&a.onHandleDown(),angular.element("body").bind("selectstart"+e,function(){return!1}),a.disabled||(H=!0,d.addClass("ngrs-down"),y.addClass("ngrs-focus "+g),angular.element("body").addClass("ngrs-touching"),b.bind(i,function(b){b.preventDefault();var e,f,g=m(b),h=a.step/G*100,i=((0===c?a.modelMax:a.modelMin)-a.min)/G*100;"x"!==g[0]&&(g[0]-=l[0],g[1]-=l[1],e=[o[0]!==g[0],o[1]!==g[1]],f=k+100*g[E]/(E?y.height():y.width()),f=n(f),a.preventEqualMinMax&&(0===h&&(h=1/G*100),0===c?i-=h:1===c&&(i+=h)),0===c?f=f>i?i:f:1===c&&(f=i>f?i:f),a.step>0&&100>f&&f>0&&(f=Math.round(f/h)*h),f>95&&0===c?d.css("z-index",3):d.css("z-index",""),e[E]&&f!=p&&(0===c?a.modelMin=parseFloat(parseFloat(f*G/100+a.min).toFixed(a.decimalPlaces)):1===c&&(a.modelMax=parseFloat(parseFloat(f*G/100+a.min).toFixed(a.decimalPlaces))),a.$apply(),p=f),o=g)}).bind(j,function(){angular.isFunction(a.onHandleUp)&&a.onHandleUp(),b.off(i),b.off(j),angular.element("body").removeClass("ngrs-touching"),H=!1,d.removeClass("ngrs-down"),d.removeClass("ngrs-over"),y.removeClass("ngrs-focus "+g)}))}).on(k,function(){d.addClass("ngrs-over")}).on(l,function(){H||d.removeClass("ngrs-over")})}function w(b){throw a.disabled=!0,new Error("RangeSlider: "+b)}function x(a){d.warn(a)}var y=angular.element(g),z=[g.find(".ngrs-handle-min"),g.find(".ngrs-handle-max")],A=[g.find(".ngrs-value-min"),g.find(".ngrs-value-max")],B=g.find(".ngrs-join"),C="left",D="right",E=0,F=[0,0],G=0,H=!1;a.filteredModelMin=a.modelMin,a.filteredModelMax=a.modelMax,p.$observe("disabled",function(b){angular.isDefined(b)||(a.disabled=f.disabled),a.$watch("disabled",s)}),p.$observe("orientation",function(b){angular.isDefined(b)||(a.orientation=f.orientation);for(var c,d=a.orientation.split(" "),e=0,g=d.length;g>e;e++)d[e]="ngrs-"+d[e];c=d.join(" "),y.addClass(c),("vertical"===a.orientation||"vertical left"===a.orientation||"vertical right"===a.orientation)&&(C="top",D="bottom",E=1)}),p.$observe("step",function(b){angular.isDefined(b)||(a.step=f.step)}),p.$observe("decimalPlaces",function(b){angular.isDefined(b)||(a.decimalPlaces=f.decimalPlaces)}),p.$observe("showValues",function(b){angular.isDefined(b)?"false"===b?a.showValues=!1:a.showValues=!0:a.showValues=f.showValues}),p.$observe("pinHandle",function(b){angular.isDefined(b)&&("min"===b||"max"===b)?a.pinHandle=b:a.pinHandle=null,a.$watch("pinHandle",r)}),p.$observe("preventEqualMinMax",function(b){angular.isDefined(b)?"false"===b?a.preventEqualMinMax=!1:a.preventEqualMinMax=!0:a.preventEqualMinMax=f.preventEqualMinMax}),p.$observe("attachHandleValues",function(b){angular.isDefined(b)?"true"===b||""===b?(a.attachHandleValues=!0,g.find(".ngrs-value-runner").addClass("ngrs-attached-handles")):a.attachHandleValues=!1:a.attachHandleValues=f.attachHandleValues}),a.$watch("min",t),a.$watch("max",t),a.$watch("modelMin",u),a.$watch("modelMax",u),a.$on("$destroy",function(){y.off(e),angular.element("body").off(e),b.off(e);for(var a=0,c=z.length;c>a;a++)z[a].off(e),z[a].off(e+"X")}),y.bind("selectstart"+e,function(a){return!1}).bind("click",function(a){a.stopPropagation()}),v(0),v(1)}}}]),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()}();